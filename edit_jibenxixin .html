<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"
    />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="css/aui.css" />
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="stylesheet" type="text/css" href="css/house.css" />
</head>

<body class="layout-w">
    <header class="aui-bar aui-bar-nav" id="header">
        <a class="aui-btn aui-pull-left" onclick="closeWin()">
            <i class="aui-iconfont aui-icon-left"></i>
        </a> 基本信息
        <a class="aui-btn aui-pull-right">
        </a>
    </header>

    <!-- 基本资料 -->
    <div id="info">
      <form id="form2" action="">
        <div class="house-info clearfix">
            <div class="block-item clearfix">
                <label class="form-row form-text-row">
                    <em class="form-text-label">小区名称</em>
                    <span class="input-wrapper community-name" id="housename">海润国际公寓</span>
                </label>
            </div>
            <div class="block-item clearfix">
                <label class="form-row form-text-row">
                    <em class="form-text-label">房源位置</em>
                    <span class="input-wrapper">
                        <input id="position_one" type="text" class="form-text-input short-input" name="position_one" data-required="true" data-descriptions="position_one">号楼/座
                    </span>
                </label>
            </div>
            <div class="block-item clearfix">
                <div class="form-row form-text-row">
                    <em class="form-text-label"></em>
                    <span class="input-wrapper">
                        <input id="position_two" type="text" class="form-text-input short-input" name="position_two" data-required="true" data-descriptions="position_two">单元
                    </span>
                </div>
            </div>
            <div class="block-item clearfix">
                <label class="form-row form-text-row">
                    <em class="form-text-label"></em>
                    <span class="input-wrapper">
                        <input id="position_three" type="text" class="form-text-input short-input" name="position_three" data-required="true" data-descriptions="position_three">室
                    </span>
                </label>
            </div>
            <div class="block-item clearfix">
                <label class="form-row form-text-row">
                    <em class="form-text-label">实际楼层</em>
                    <span class="input-wrapper">
                        <input id="floor" type="text" class="form-text-input short-input" data-pattern="^[0-9]+$"  name="floor" data-required="true" data-descriptions="foolr">楼
                        <br>
                    </span>
                    <div class="tips">注：具体门牌号不会显示在发布的房书中，信息仅用于房书相关数据制作。</div>
                </label>
            </div>
            <div class="block-item clearfix">
                <label class="form-row form-text-row" style="line-height: 32px;">
                    <em class="form-text-label">居室</em>
                    <span class="input-wrapper aui-list-item-input">
                        <select id="num" name="num" data-required="true" data-descriptions="sel_one">
                            <option value=""selected disabled>请选择</option>
                            <option id="1">1</option>
                            <option id="2">2</option>
                            <option id="3">3</option>
                            <option id="4">4</option>
                            <option id="5">5</option>
                        </select>
                    </span>
                </label>
            </div>
            <div class="block-item clearfix">
                <div class="form-row form-text-row">
                    <em class="form-text-label">面积</em>
                    <span class="input-wrapper">
                        <input id="area" type="text" class="form-text-input short-input" data-pattern="^[0-9]+$"  name="area" data-required="true" data-descriptions="area">㎡
                    </span>
                </div>
            </div>
            <div class="block-item clearfix">
                <label class="form-row form-text-row">
                    <em class="form-text-label">销售总价</em>
                    <span class="input-wrapper">
                        <input id="total" type="text" class="form-text-input short-input" data-pattern="^[0-9]+$"  name="total" data-required="true" data-descriptions="total">万元
                    </span>
                </label>
            </div>
        </div>
        <div class="house-info mt15 clearfix">
            <div class="header">
                搜索标签关键字
            </div>
            <div class="block-item clearfix">
                <div class="aui-list-item-inner search-key">
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="1"> 带花园</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="2"> 带露台</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="3"> Loft/跃层</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="4"> 双卫</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="5"> 明卫</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="6"> 地铁</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="7"> 商住两用</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="8"> 个人房源</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="9"> 满五唯一</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="10"> 满二唯一</label>
                    <label>
                        <input class="aui-checkbox" type="checkbox" name="checkbox" data-required="true" data-descriptions="checkbox" value="11"> 24小时热水</label>
                </div>
            </div>
            <div class="block-item clearfix">
                <div class="form-row form-text-row">
                    <em class="form-text-label">备注/推荐</em>
                    <span class="input-wrapper">
                        <input id="remark" type="text" class="form-text-input short-input" name="remark" data-required="true" data-descriptions="remark">单元
                    </span>
                </div>
            </div>
        </div>

        <div class="space clearfix">&nbsp;</div>
        <div class="house-info-btn clerfix">
            <div class="add">
              <input id="" type="submit" value="保存修改"/>
            </div>
        </div>
      </form>
    </div>
    <!-- 基本资料 -->
</body>
<script type="text/javascript" src="js/api.js"></script>
<script type="text/javascript" src="js/commenjs.js"></script>
<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="js/jquery-mvalidate.js"></script>
<link rel="stylesheet" type="text/css" href="css/mvalidate.css">
<script type="text/javascript">
apiready = function(){

  //获取基本信息
  var houseid=$api.getStorage("houseid");
  api.ajax({
    url: 'http://123.58.253.71:8808/FHMYSQL/get_baseInfo',
    method: 'post',
    dataType:'text',
    values: {
      houseid:houseid
    }
  },
  function(ret, err){
   if (ret) {
      //ret为返回数据 将数据进行绑定
      //房源位置 楼 单元 号
      //  var location=ret.LOCATION;
      //  var reg=/[\u4E00-\u9FA5]/g;
	    //  var result=location.replace(reg,",");
      //  var data=location.split(",");
      //  document.getElementById('position_one').value=data[0];
      //  document.getElementById('position_two').value=data[1];
      //  document.getElementById('position_three').value=data[2];
      //实际楼层
       var floor=ret.FLOOR;
        document.getElementById("floor").value=floor;
      //几居室 下拉框
       var room=ret.ROOM;
         $("select#num").val(room);
      //面积
       var area=ret.AREA;
       document.getElementById("area").value=area;
      //总售价
       var price=ret.PRICR;
       document.getElementById("total").value=price;
      //关键字
       var keyword=ret.KEYWORD.split(",");
       for (var i = 0; i < keyword.length; i++) {
         document.getElementById(keyword[i]).checked="true";
       }
      //备注
       var remark=ret.REMARK;
       document.getElementById("remark").value=remark;
   } else {
     alert("失败，请稍后重试");
   }
  });

  //数据验证
  $("#form2").mvalidate({
            type:1,
            onKeyup:true,
            sendForm:true,
            firstInvalidFocus:false,
            valid:function(event,options){
                //点击提交按钮时,表单通过验证触发函数
                var values={};
                values["userid"]=$api.getStorage("userInfo").userId;
                values["housename"]=document.getElementById("housename").innerHTML;
                var x=$("#form2").serializeArray();
                $.each(x, function(i, field){
                  var key=field.name,value=field.value;
                  if(values[key]){
                     values[key]=values[key]+","+value;
                  }else {
                     values[key]=value;
                  }
                });
                api.ajax({
                  url: 'http://123.58.253.71:8808/FHMYSQL/edit_baseinfo',
                  method: 'post',
                  dataType:'text',
                  data: {
                    values:values
                  }
                },
               function(ret, err){
                 if (ret!="error") {
                  //  $api.setStorage('houseid', ret);
                    api.openWin({
                      name:'预览',
                      url: 'preview.html'
                    });
               } else {
                   alert("失败，请稍后重试");
                    }
                });

                 event.preventDefault();
            },
            invalid:function(event, status, options){
                //点击提交按钮时,表单未通过验证触发函数
            },
            eachField:function(event,status,options){
                //点击提交按钮时,表单每个输入域触发这个函数 this 执向当前表单输入域，是jquery对象
            },
            eachValidField:function(val){},
            eachInvalidField:function(event, status, options){},
            descriptions:{
                position_one:{
                    required : '请输入房源楼号'
                },
                position_two:{
                    required : '请输入房源单元信息'
                },
                position_three:{
                    required : '请输入房源位置'
                },
                floor : {
                    required : '请输入房源楼层',
                    pattern : '楼层数据格式不合法'
                },
                num:{
                    required : '请输入居室数目',
                },
                area:{
                    required : '请输入房屋面积',
                    pattern : '房屋面积数据格式不合法'
                },
                total:{
                    required : '请输入房屋总价',
                    pattern : '总价数据格式不合法'
                },
                remark:{
                    required : '请输入备注'
                },
                checkbox:{
                    required : '请选择房屋标签'
                }
            }
        });
});
</script>
</html>
